<!-- Version - 6 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Assistant</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="assistant">
        <div id="chat-window">
            <div id="chat-title">
                <h1>ATLAS</h1>
            </div>
            <div id="chat-log"></div>
            <input type="text" id="user-input" placeholder="Type a message...">
            <button id="send-btn">Send</button>
            <button id="listen-btn">Listen</button>
        </div>
    </div>
<!--     <script src="scripts.js"></script> -->
    <script type="text/javascript">




// Check for browser support
window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

function startSpeechRecognition() {
    if (!window.SpeechRecognition) {
        alert("Speech Recognition is not supported in your browser. Please try using Google Chrome.");
        return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US'; // You can change this to any supported language
    recognition.interimResults = false; // Set to true if you want to get partial (interim) results
    recognition.maxAlternatives = 1; // Maximum number of alternatives for recognition

    recognition.start();

    recognition.onresult = function(event) {
        // The SpeechRecognitionEvent results property returns a SpeechRecognitionResultList object
        // The SpeechRecognitionResultList contains SpeechRecognitionResult objects.
        // It has a getter so it can be accessed like an array
        // The first [0] returns the SpeechRecognitionResult at the last position.
        // Each SpeechRecognitionResult object contains SpeechRecognitionAlternative objects that contain individual results.
        // These also have getters so they can be accessed like arrays.
        // The first [0] returns the SpeechRecognitionAlternative with the highest confidence.
        const transcript = event.results[0][0].transcript;
        console.log("You said: ", transcript);

        // You can set the recognized text to the input field or process it as needed
        document.getElementById("user-input").value = transcript;

        // Optionally, trigger the processing of user input after recognition
        handleUserInput();
    };

    recognition.onerror = function(event) {
        console.error("Speech recognition error detected: " + event.error);
    };

    recognition.onend = function() {
        console.log("Speech recognition service disconnected");
    };
}

// Attach event listener to the Listen button
document.getElementById("listen-btn").addEventListener("click", startSpeechRecognition);

window.speechSynthesis.onvoiceschanged = function() {
    // Re-fetch the voices after they have loaded
    const femaleVoice = getFemaleVoice();
    console.log(femaleVoice);
};


function getFemaleVoice() {
    const voices = window.speechSynthesis.getVoices();
    // Filter for female voices (this may vary depending on the available voices in the browser)
    const femaleVoices = voices.filter(voice => voice.name.includes('Female') || voice.name.includes('woman'));
    // Return the first female voice found, or a default voice if none found
    return femaleVoices.length > 0 ? femaleVoices[0] : voices[0];
    // return voices[7];
}

// Function to speak a given text using the Web Speech API
function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    var femaleVoice = getFemaleVoice();
    utterance.voice = femaleVoice;
    console.log(femaleVoice)
    utterance.lang = 'en-US'; // You can change this to the desired language
    // window.setTimeout(function () {window.speechSynthesis.speak(utterance);}, 250);
    window.speechSynthesis.speak(utterance);
}

// Function to get current time
function getCurrentTime() {
    const now = new Date();
    return now.toLocaleTimeString();
}

// Function to get current date
function getCurrentDate() {
    const now = new Date();
    return now.toLocaleDateString();
}

// Function to replace placeholders with dynamic values
function replacePlaceholders(response, userInput) {
    return response
        .replace(/PDA_NAME/g, "Atlas")
        .replace(/CURRENT_TIME/g, getCurrentTime())
        .replace(/CURRENT_DATE/g, getCurrentDate())
        // .replace(/GPS_URL/g, "https://www.google.com/maps?q=" + encodeURIComponent(userInput.replace(/ /g, '+')))
        // .replace(/MY_SEARCH_URL/g, "https://void-web-search-app.vercel.app/search/" + encodeURIComponent(userInput.replace(/ /g, '+')))
        // .replace(/SEARCH_URL/g, "https://www.google.com/search?q=" + encodeURIComponent(userInput.replace(/ /g, '+')) + "&igu=1");
        .replace(/GPS_URL/g, "https://www.google.com/maps?q=" + userInput.replace(/ /g, '+'))
        //.replace(/MY_SEARCH_URL/g, "https://void-web-search-app.vercel.app/search/" + userInput.replace(/ /g, '+'))
        .replace(/MY_SEARCH_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "&btnI")
        .replace(/SEARCH_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "&btnI")
        .replace(/PLAY_VIDEOS_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "+on+YouTube&btnI")
        .replace(/BOOK_MOVIE_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "+on+Book+My+Show&btnI")
        .replace(/BOOK_BUS_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "+on+red+bus&btnI")
        .replace(/BOOK_TRAIN_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "&btnI")
        .replace(/BOOK_FLIGHT_URL/g, "https://www.google.com/search?q=" + userInput.replace(/ /g, '+') + "+on+indigo&btnI");
}

// Function to process user input
function handleUserInput() {
    const userInput = document.getElementById("user-input").value;
    const userInputEditted = document.getElementById("user-input").value.replace(/\./g, " . ").replace(/\?/g, " ? ").replace(/\!/g, " ! ").replace(/\,/g, " , ").replace(/\:/g, " : ").replace(/\'/g, " ' ").replace(/\"/g, " \" ");
    const chatLog = document.getElementById("chat-log");

    if (userInput.trim() === "") return;

    // Append user's message to chat log
    const userMessage = document.createElement("p");
    userMessage.textContent = "You: " + userInput;
    chatLog.appendChild(userMessage);

    // Predict the intent using logistic regression
    const intent = predictIntent(userInputEditted, weights, vocabulary);

    var selectedResponse = "AI: I didn't understand that.";
    if (intent) {
        const assistantMessage = document.createElement("p");
        // assistantMessage.textContent = "Veronica: " + intent.response[0];
        // assistantMessage.textContent = "Veronica: " + replacePlaceholders(intent.response[0], userInput);
        // const selectedResponse = intent.response[0]; 
        console.log(intent);
        console.log();
        console.log(intent.response);
        console.log();
        var selectedResponse = intent.response[Math.floor(Math.random() * intent.response.length)];
        var displayResponse = replacePlaceholders(selectedResponse, userInput);
        assistantMessage.innerHTML = "AI: " + displayResponse;
        chatLog.appendChild(assistantMessage);
        // const finalResponse = replacePlaceholders(responseTemplate, userInput);
    } else {
        const assistantMessage = document.createElement("p");
        assistantMessage.textContent = selectedResponse;
        chatLog.appendChild(assistantMessage);
    }

    // Clear user input and scroll chat to the bottom
    document.getElementById("user-input").value = "";
    chatLog.scrollTop = chatLog.scrollHeight;
    speak(displayResponse.split('<')[0])
    if (displayResponse.indexOf('"https') > -1) { window.open("https" + displayResponse.split('"https')[1].split('"')[0], target="_blank")}

}

// Attach event listener to the Send button
document.getElementById("send-btn").addEventListener("click", handleUserInput);

// Allow pressing Enter to send message
document.getElementById("user-input").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        handleUserInput();
    }
});        
    </script>
</body>
</html>
